---
- name: bootstrap stepCA
  ansible.builtin.command: 
    argv: 
      - step 
      - ca
      - bootstrap 
      - --ca-url https://ca 
      - --fingerprint 70e19eaccd49e4e7bed26adce4b426be6facd82e98526aa38493b00cf29b86f4 

- name: Install Root Certificate
  ansible.builtin.command: 
    argv: 
      - step
      - certificate
      - install 
      - --all ~/.step/certs/root_ca.crt

- name: Update CA trust store (Red Hat/CentOS)
  ansible.builtin.command: update-ca-trust extract
  when: ansible_facts['os_family'] == "RedHat"

- name: Update CA trust store (Debian/Ubuntu)
  ansible.builtin.command: update-ca-certificates
  when: ansible_facts['os_family'] == "Debian"

- name: Update CA trust store (SUSE)
  ansible.builtin.command: update-ca-certificates
  when: ansible_facts['os_family'] == "Suse"

- name: Update CA trust store (Alpine)
  ansible.builtin.command: update-ca-certificates
  when: ansible_facts['os_family'] == "Alpine"
