---
- name: Ensure standard user exists (root)
  ansible.builtin.user:
    name: remote_mgr
    groups: sudo, users
    uid: 5003
    shell: /bin/bash
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: .ssh/id_rsa
  become: false
  tags:
    - always
  when:
    - become_user is defined
    - not become_user

- name: Ensure standard user exists (non-root)
  ansible.builtin.user:
    name: remote_mgr
    groups: sudo, users
    uid: 5003
    shell: /bin/bash
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: .ssh/id_rsa
  become: true
  tags:
    - always
  when:
    - become_user is not defined or become_user

- name: Ensure sudoers is updated (root)
  ansible.builtin.copy:
    src: 80-remote-mgr
    dest: /etc/sudoers.d/80-remote-mgr
    owner: root
    group: root
    mode: '0440'
  tags:
    - always
  when:
    - become_user is defined
    - not become_user

- name: Ensure sudoers is updated (non-root)
  ansible.builtin.copy:
    src: 80-remote-mgr
    dest: /etc/sudoers.d/80-remote-mgr
    owner: root
    group: root
    mode: '0440'
  tags:
    - always
  when:
    - become_user is not defined or become_user
